WITH RECURSIVE EmployeeHierarchy AS (
    -- –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–µ–∫—É—Ä—Å–∏–∏: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ (EmployeeID = 1)
    SELECT
        e.EmployeeID,
        e.Name AS EmployeeName,
        e.ManagerID,
        e.DepartmentID,
        e.RoleID
    FROM Employees e
    WHERE e.EmployeeID = 1

    UNION ALL

    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
    SELECT
        e.EmployeeID,
        e.Name AS EmployeeName,
        e.ManagerID,
        e.DepartmentID,
        e.RoleID
    FROM Employees e
    INNER JOIN EmployeeHierarchy eh ON e.ManagerID = eh.EmployeeID
)

SELECT
    eh.EmployeeID,
    eh.EmployeeName,
    eh.ManagerID,
    d.DepartmentName,
    r.RoleName,
    -- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü
    COALESCE(GROUP_CONCAT(DISTINCT p.ProjectName ORDER BY p.ProjectName SEPARATOR ', '), NULL) AS ProjectNames,
    -- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü
    COALESCE(GROUP_CONCAT(DISTINCT t.TaskName ORDER BY t.TaskName SEPARATOR ', '), NULL) AS TaskNames,
    COUNT(DISTINCT t.TaskID) AS TotalTasks, -- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    (SELECT COUNT(*) FROM Employees sub WHERE sub.ManagerID = eh.EmployeeID) AS TotalSubordinates -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
FROM EmployeeHierarchy eh
LEFT JOIN Departments d ON eh.DepartmentID = d.DepartmentID
LEFT JOIN Roles r ON eh.RoleID = r.RoleID
LEFT JOIN Projects p ON p.DepartmentID = eh.DepartmentID
LEFT JOIN Tasks t ON t.AssignedTo = eh.EmployeeID
GROUP BY eh.EmployeeID, eh.EmployeeName, eh.ManagerID, d.DepartmentName, r.RoleName
ORDER BY eh.EmployeeName;

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
CTE EmployeeHierarchy

–°—Ç—Ä–æ–∏—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –Ω–∞—á–∏–Ω–∞—è —Å –ò–≤–∞–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞ (EmployeeID = 1).

–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö –∏ –∏—Ö –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö.

–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å

–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–∞–±–ª–∏—Ü Departments, Roles, Projects –∏ Tasks.

GROUP_CONCAT –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∑–∞–¥–∞—á –≤ –æ–¥–∏–Ω
—Å—Ç–æ–ª–±–µ—Ü (—Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç–æ–π).

COUNT(DISTINCT t.TaskID) –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á.

–ü–æ–¥–∑–∞–ø—Ä–æ—Å (SELECT COUNT(*) FROM Employees sub WHERE
sub.ManagerID = eh.EmployeeID) –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö.

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ EmployeeName.

–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. üöÄ